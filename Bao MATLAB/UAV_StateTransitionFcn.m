function xk1 = UAV_StateTransitionFcn(xk, uk)
% UAV_StateTransitionFcn  – dynamique d'état du RNN
%
%   xk  : état caché actuel (nx x 1)
%   uk  : commande actuelle (scalaire : tension rotor, en unités physiques)
%   xk1 : état caché suivant (nx x 1)
    
    % Temps d'échantillonage
    Ts = 0.05;
    
    % Chargement des paramètres du modèle 
    Wx  = [-0.054810613 -0.19828075 0.0106349485 0.2670654 -0.2565651 -0.22373678 -0.13743405 -0.07475256 -0.0030581283 -0.039485857 -0.08881847 -0.2708574 0.08075313 0.21486944 0.17371957 -0.17640379; -0.19976129 0.09573704 0.26060626 0.030317163 0.07674417 0.07298602 0.12963814 0.16420981 0.122596726 0.11134063 -0.21158268 0.121400334 -0.13970605 0.18573807 0.21534824 -0.22029392; -0.2831516 0.11080484 0.16430902 -0.41111085 0.14245363 0.28410262 0.22283375 -0.14697093 -0.22541955 0.27402517 -0.030577973 -0.09287284 -0.234945 -0.15100063 0.12818286 -0.18158971; 0.05690743 -0.26979622 -0.08870702 -0.038804416 -0.04578371 -0.20987086 0.21087363 0.18155152 -0.061583202 -0.16021223 0.28173977 -0.03942703 -0.010327206 -0.13087074 -0.09135673 -0.10254689; -0.26409703 -0.18439199 0.020932237 0.058338992 0.020068428 0.040261988 -0.07756588 -0.09827179 -0.15889177 -0.27361715 -0.11424161 0.037519984 0.21816179 0.22950579 -0.30133572 0.04534288; 0.05915103 0.23462655 -0.029012982 -0.31983006 0.21155746 0.1799367 0.18011913 0.13400978 0.14254148 -0.25356704 -0.23624778 0.350753 -0.22311826 -0.17746127 0.08574803 -0.2498833; 0.2302472 0.10535461 0.3825794 -0.07267087 0.050257556 0.07168442 0.1682115 0.26044172 0.058120802 0.36317724 -0.11772295 -0.31889462 -0.22113736 0.0052675353 0.3176511 -0.15303527; 0.03251225 0.034890667 0.017671935 -0.24851422 0.09448883 0.09391822 0.11358788 -0.31038007 0.058643762 0.16441427 0.2630902 0.27487594 0.10068757 -0.04099711 0.25031468 0.2945607; 0.049766067 0.2243491 0.2327006 0.121227555 0.15868858 -0.08850173 -0.024478467 0.3149645 0.3047527 -0.10457941 0.13757247 -0.2157516 0.09147136 -0.16519417 0.26284066 0.18569171; -0.084229745 0.29801103 0.09633372 -0.1579623 -0.08097195 0.090411045 0.04303354 0.22450763 0.15999785 -0.14340816 0.18596545 0.14565226 -0.0276399 -0.13384257 -0.063124895 -0.028881682; -0.007556908 0.012201079 -0.16588311 0.012694401 -0.28801605 -0.051275395 -0.025869913 -0.014896692 0.001251778 0.015148371 -0.111195795 -0.116921246 0.20413154 -0.15108445 0.20130841 0.15290904; -0.0012838877 0.2192543 0.15785252 -0.009917233 -0.11700731 -0.056336824 -0.007751862 -0.04253185 -0.36011848 0.052848127 0.024973009 0.10581629 0.08032532 0.03380221 -0.32158968 -0.23985775; -0.10666029 0.2266655 0.016423741 -0.53046066 0.12992862 0.6130419 -0.028229231 0.052079115 0.1166846 0.4789001 -0.2313041 0.34835717 -0.39233664 0.15539384 -0.32069686 -0.16463448; -0.03189107 0.1455103 0.2735598 0.040694628 -0.049550243 -0.029286861 -0.039975982 -0.10124461 0.19787547 -0.06621207 -0.20404543 0.03320602 0.234311 0.18877007 -0.22984253 -0.035290796; -0.15501505 0.0458964 -0.18534362 0.2360823 0.057752233 -0.22665486 -0.17267567 -0.27005205 0.22145328 -0.031006517 0.020260494 -0.29137778 0.1985333 -0.0057401545 0.23700395 0.059118446; -0.032807212 0.08681327 -0.09811097 0.15400505 -0.15555269 -0.08529856 0.0922271 0.01761581 0.22681507 -0.17259191 -0.117050245 -0.18081076 -0.0699918 -0.22640716 -0.022388794 -0.20143695];

    Wu  = [0.0011520714; -0.024631921; -0.15932404; 0.18886079; -0.15841006; -0.049957644; -0.047560625; 0.057002228; 0.0817428; 0.014981229; 0.11649767; -0.16112043; 0.058618333; -0.09284596; 0.1187288; 0.13486035];
    bxu = [-0.36906832 0.229482 0.27262983 0.10612045 0.1842462 0.05776054 -0.4599747 -0.06735515 0.16706344 -0.21847841 -0.2055846 -0.37176389 0.0035472214 -0.25309324 0.087765664 -0.04781279];
    bxu = bxu(:);

    nx_rnn = 16;

    % norm_y: Output normalization
    norm_y = 31;
    % Wf: Hidden-to-output layer weights (head_weight)
    Wf  = norm_y*[0.27760112 -0.2601397 0.044867698 -0.07303544 -0.08680173 -0.25342372 0.33343402 0.066322625 -0.20720585 0.0026020494 0.030595733 0.02519219 -0.33045354 -0.21485117 0.14890341 -0.05969526];
    % bf: Output layer bias (head_bias)
    bf  = norm_y*(-0.00402784);

    % --- Normalisation de la commande (comme dans le training PyTorch) ---
    h  = xk(1:nx_rnn);        % état caché (16x1)
    z  = xk(nx_rnn+1);        % position actuelle
    vz = xk(nx_rnn+2);        % vitesse actuelle

    u  = uk(1);   % commande scalaire
    h_next = tanh(Wx * h + Wu * u + bxu);

    az = Wf * h_next + bf;    % scalaire

    z_next  = z  + Ts * vz;
    vz_next = vz + Ts * az;

    xk1 = [h_next; z_next; vz_next];
end
